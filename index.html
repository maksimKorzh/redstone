<html>
<div id="board"></div>
<div id="tools">
  <table cellspacing="0">
    <tr>
      <td><button onclick="tool=0;">Operate</button></td>
      <td><button onclick="tool=SWITCH;">Switch</button></td>
      <td><button onclick="tool=2;">Button</button></td>
      <td><button onclick="tool=3;">Invertor</button></td>
      <td><button onclick="tool=4;">Wire</button></td>
      <td><button onclick="tool=5;">Light</button></td>
      <td><button onclick="tool=7;">Erase</button></td>
    </tr>
  </table>
</div>
<script>
  const EMPTY = 0;
  const OPERATE = 8;
  const SWITCH = 1;
  const BUTTON = 2;
  const INVERTOR = 3;
  const WIRE = 4;
  const LIGHT = 5;
  const ERASE = 7;
  const OFFBOARD = 8;

  var WIDTH = 11;
  var HEIGHT = 11;
  var SIZE = WIDTH * HEIGHT;
  
  var board = new Array(SIZE);
  var tool = OPERATE;
  
  function initBoard() {
    for (let row = 0; row < HEIGHT; row++) {
      for (let col = 0; col < WIDTH; col++) {
        square = row * WIDTH + col;
        board[square] = 0;
        if (col == 0 || col == WIDTH-1 || row == 0 || row == HEIGHT-1) board[square] = OPERATE;
      }
    }
  }
  
  function printBoard() {
    var boardHTML = '<table cellspacing="0">';
    for (let row = 0; row < HEIGHT; row++) {
      boardHTML += '<tr>'
      for (let col = 0; col < WIDTH; col++) {
        if (col == 0 || col == WIDTH-1 || row == 0 || row == HEIGHT-1) continue;
        let square = row*WIDTH+col;
        boardHTML += '<td id=' + square + ' \
                          style="border: 0px; \
                          width: 40px; height: 40px;" \
                          onclick="clickSquare(this.id, tool)">'
                          + renderElement(square) +
                          '</td>';
      } boardHTML += '</tr>';
    }
    
    boardHTML += '</table>';
    document.getElementById('board').innerHTML = boardHTML;
  }
  
  function renderElement(square) {
    var render = '';
    switch (board[square]) {
      case 0: render = '<div style="width: 100%; height: 100%; background-color: grey;"></div>'; break;
      case 1:
      case (1 | 32): render = '<input type="checkbox" ' + ((board[square] & 32) ? 'checked' : '') +
                         ' onclick="board[' + square + '] ^= 32;"/>';
                         break;
      
      case 4: render = '<div style="width: 100%; height: 100%; background-color: green;"></div>'; break;
      
      case 5:
      case (5 ^ 32):
              render = '<div style="width: 100%; height: 100%; background-color: '
              + ((board[square] & 32) ? 'red' : 'darkred') +
              ';"></div>';
              break;
      

    }
    
    return render;
  }
  
  function traceWire(square) {
    if (board[square]) board[square] |= 32;
  }
  
  function updateBoard() {
    for (let sq = 0; sq < SIZE; sq++) {
      
    }
  }
  
  function clickSquare(square, value) {
    if (tool == OPERATE) {
      if (board[square]==5) isPowered(square);
      return;
    } else if (tool == ERASE) {
      board[square] = 0;
    } else {
      board[square]=tool;
    }
    printBoard();
  }
  
  function isPowered(square) {
    if (board[square]) {
    
    }
  }

  initBoard();   
  printBoard();
  
  setInterval(function() {
    printBoard();
  }, 1000);
</script>
</html>